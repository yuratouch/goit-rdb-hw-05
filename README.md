# üß© –î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è –¥–æ –¢–µ–º–∏ 5. –í–∫–ª–∞–¥–µ–Ω—ñ –∑–∞–ø–∏—Ç–∏. –ü–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–æ–¥—É

–¶–µ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –º—ñ—Å—Ç–∏—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–µ –ø—Ä–∞–∫—Ç–∏—á–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è –¥–æ —Ç–µ–º–∏ ‚Ññ5 –∑ –∫—É—Ä—Å—É **–†–µ–ª—è—Ü—ñ–π–Ω—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö**.  
–ó–∞–≤–¥–∞–Ω–Ω—è –ø—Ä–∏—Å–≤—è—á–µ–Ω–µ —Ä–æ–±–æ—Ç—ñ –∑ –≤–∫–ª–∞–¥–µ–Ω–∏–º–∏ –∑–∞–ø–∏—Ç–∞–º–∏ (`subquery`), —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è–º —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö —Ç–∞–±–ª–∏—Ü—å (`WITH`) —Ç–∞ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è–º –≤–ª–∞—Å–Ω–∏—Ö SQL-—Ñ—É–Ω–∫—Ü—ñ–π.

---

## üìö –ó–º—ñ—Å—Ç

1. [üîç –í–∫–ª–∞–¥–µ–Ω–∏–π –∑–∞–ø–∏—Ç —É SELECT](#1-–≤–∫–ª–∞–¥–µ–Ω–∏–π-–∑–∞–ø–∏—Ç-—É-select)
2. [üóÇÔ∏è –í–∫–ª–∞–¥–µ–Ω–∏–π –∑–∞–ø–∏—Ç —É WHERE](#2-–≤–∫–ª–∞–¥–µ–Ω–∏–π-–∑–∞–ø–∏—Ç-—É-where)
3. [üîÑ –í–∫–ª–∞–¥–µ–Ω–∏–π –∑–∞–ø–∏—Ç —É FROM](#3-–≤–∫–ª–∞–¥–µ–Ω–∏–π-–∑–∞–ø–∏—Ç-—É-from)
4. [üì¶ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è CTE —á–µ—Ä–µ–∑ WITH](#4-cte-—á–µ—Ä–µ–∑-with)
5. [üßÆ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó —Ç–∞ —ó—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è](#5-—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è-—Ñ—É–Ω–∫—Ü—ñ—ó-—Ç–∞-–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è)
6. [‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫](#–≤–∏—Å–Ω–æ–≤–æ–∫)

---

## 1. –í–∫–ª–∞–¥–µ–Ω–∏–π –∑–∞–ø–∏—Ç —É SELECT

```sql
SELECT
  order_details.*,
  (SELECT orders.customer_id
   FROM orders
   WHERE orders.id = order_details.order_id
  ) AS customer_id
FROM order_details;
```

üñºÔ∏è ![p1-rdb-hw5.png](./p1-rdb-hw5.png)

---

## 2. –í–∫–ª–∞–¥–µ–Ω–∏–π –∑–∞–ø–∏—Ç —É WHERE

```sql
SELECT *
FROM order_details
WHERE order_id IN (
  SELECT id
  FROM orders
  WHERE shipper_id = 3
);
```

üñºÔ∏è ![p2-rdb-hw5.png](./p2-rdb-hw5.png)

---

## 3. –í–∫–ª–∞–¥–µ–Ω–∏–π –∑–∞–ø–∏—Ç —É FROM

```sql
SELECT
  filtered.order_id,
  ROUND(AVG(filtered.quantity), 2) AS avg_quantity
FROM (
  SELECT *
  FROM order_details
  WHERE quantity > 10
) AS filtered
GROUP BY filtered.order_id;
```

üñºÔ∏è ![p3-rdb-hw5.png](./p3-rdb-hw5.png)

---

## 4. CTE —á–µ—Ä–µ–∑ WITH

```sql
WITH temp AS (
  SELECT *
  FROM order_details
  WHERE quantity > 10
)
SELECT
  temp.order_id,
  ROUND(AVG(temp.quantity), 2) AS avg_quantity
FROM temp
GROUP BY temp.order_id;
```

üñºÔ∏è ![p4-rdb-hw5.png](./p4-rdb-hw5.png)

---

## 5. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

```sql
DROP FUNCTION IF EXISTS divide_numbers;

DELIMITER //

CREATE FUNCTION divide_numbers(a FLOAT, b FLOAT)
RETURNS FLOAT
DETERMINISTIC
BEGIN
  RETURN a / b;
END //

DELIMITER ;

SELECT
  id,
  quantity,
  divide_numbers(quantity, 2) AS divided_quantity
FROM order_details;
```

üñºÔ∏è ![p5-rdb-hw5.png](./p5-rdb-hw5.png)

---

## ‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫

üìå –£ —Ü—å–æ–º—É –∑–∞–≤–¥–∞–Ω–Ω—ñ:

- –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Ä–æ–±–æ—Ç—É –∑ —Ä—ñ–∑–Ω–∏–º–∏ –≤–∏–¥–∞–º–∏ –≤–∫–ª–∞–¥–µ–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä `WITH` –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ –∫–æ–¥—É
- –°—Ç–≤–æ—Ä–µ–Ω–æ –≤–ª–∞—Å–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é –≤ MySQL –¥–ª—è –æ–±—á–∏—Å–ª–µ–Ω—å
- –ó–∞–±–µ–∑–ø–µ—á–µ–Ω–æ –Ω–∞–æ—á–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø–∏—Ç—ñ–≤ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

> ‚úçÔ∏è _–°–∫—Ä—ñ–Ω—à–æ—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –¥–æ–¥–∞—é—Ç—å—Å—è –¥–æ –∫–æ–∂–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É –¥–ª—è –≤—ñ–∑—É–∞–ª—å–Ω–æ–≥–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è._
